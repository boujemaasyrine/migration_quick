function saveCa(a,t,e){ajaxCall({url:Routing.generate("save_single_ca",{ca:a}),dataType:"json",method:"post",data:{ca:t}},function(a){null==a.data?showPopError(a.error):($(e).hide("slow"),$(e).siblings(".ca_inputs").attr("hidden-value",t),Materialize.toast("<span class='glyphicon glyphicon-ok'></span> &nbsp;&nbsp; "+Translator.trans("ca_prev_save_success"),4e3,"confirmation-toast"))})}function testDOMNumeric(a){return!(""==$(a).val().trim()||isNaN($(a).val().trim())||parseInt($(a).val().trim())<0)||($(a).focus(),$(a).addClass("shadow-danger"),!1)}function testCa(){return testDOMNumeric("#ca_typed")}function isNoComparableDay(a){for(var t=0;t<noComprabableDays.length;t++)if(noComprabableDays[t].date==a)return!0;return!1}function initPickers(){$.each($(".datepicker"),function(a,t){var e=$(t).pickadate("picker"),n=$(this);e.on("start",$(".picker").appendTo("body")),e.on("open",function(){$.each(noComprabableDays,function(a,t){addClassToDate(n.attr("id"),t.date,"no-comprable-day")})}),e.on("render",function(){$.each(noComprabableDays,function(a,t){addClassToDate(n.attr("id"),t.date,"no-comprable-day")})})})}function addClassToDate(a,t,e){var n=$("#"+a+"_table.picker__table").find(".picker__day.picker__day--infocus[aria-label='"+t+"']");0!=n.length&&null!=n&&n.addClass(e)}var calendar=null,currentCa=null,noComprabableDays=null;$(document).on("click",".save-ca-btn",function(){if($(this).siblings("input").removeClass("shadow-danger"),testDOMNumeric($(this).siblings("input"))){var a=$(this).attr("ca-id"),t=$(this).siblings("input").val();saveCa(a,t,$(this))}}),$(document).on("click",".detail-btn",function(){loader.show();var a=$(this);a.siblings("input").attr("date");ajaxCall({url:Routing.generate("details_ca_prev",{caPrev:a.attr("ca-id")}),dataType:"json"},function(t){currentCa=a.attr("ca-id"),showDefaultModal(Translator.trans("pop_details_title"),t.data,"","70%"),initDatePicker(),loader.hide(),initPickers(),$.each($(".datepicker"),function(a,t){isNoComparableDay($(t).val())&&$(t).addClass("shadow-danger")})})}),$(document).on("change","#ca_typed",function(){$("#ca_typed").removeClass("shadow-danger"),testCa()&&($("#ca_to_be_sended_calculated").removeAttr("checked"),$("#ca_to_be_sended_typed").prop("checked","checked"))}),$(document).on("change","#comparable_day, #date_1, #date_2, #date_3, #date_4, #date_5, #date_6, #date_7, #date_8",function(){$("#ca-detailed-form input.datepicker").removeClass("shadow-danger");var a=!0;if($.each($("#ca-detailed-form input.datepicker"),function(t,e){""==$(e).val().trim()&&($(e).addClass("shadow-danger"),a=!1)}),a){$(this);$("#refresh-icon").show(),rotateElement($("#refresh-icon")),$("#ca_to_be_sended_typed").removeAttr("checked"),$("#ca_to_be_sended_calculated").prop("checked","checked"),ajaxCall({url:Routing.generate("ca_refresh_data"),data:$("#ca-detailed-form").serialize(),method:"POST"},function(a){$("#refresh-icon").hide(),rotateElement($("#refresh-icon"),1),null!=a.data.ca&&($("#calculated-ca").html(Math.round(a.data.ca)+" (€)"),$("#ca-1").html(floatToString(a.data.cas[0])),$("#ca-2").html(floatToString(a.data.cas[1])),$("#ca-3").html(floatToString(a.data.cas[2])),$("#ca-4").html(floatToString(a.data.cas[3])),$("#ca-5").html(floatToString(a.data.cas[4])),$("#ca-6").html(floatToString(a.data.cas[5])),$("#ca-7").html(floatToString(a.data.cas[6])),$("#ca-8").html(floatToString(a.data.cas[7])),$("#m-1").html(floatToString(a.data.cas.m1)),$("#m-2").html(floatToString(a.data.cas.m2)),$("#variance").html(floatToString(a.data.variance)),$("#ca_comparable_day").html(floatToString(a.data.cas.comparableDayCa)+" (€)"))})}}),$(document).on("click","#save-ca",function(){testCa()&&ajaxCall({url:Routing.generate("save_ca",{ca:currentCa}),method:"POST",data:$("#ca-detailed-form").serialize()},function(a){null==a.data?console.log(a.error):window.location.reload()})}),$(document).on("keyup",".ca_inputs",function(){1==hasTheModificatioRight&&($(this).val().trim()!=$(this).attr("hidden-value")?$(this).siblings(".save-ca-btn").show():$(this).siblings(".save-ca-btn").hide())}),$(document).on("click",".export-btn",function(a){a.preventDefault();var t=$("#report_scheduleType").val(),e=$(this).data("dates").split(",");$(this).attr("href",Routing.generate("export_ca_prv_list",{schedule:t,dates:e,all:1}));var n=$(this).prop("href");window.location.href=n});var hasTheModificatioRight=null;$(document).ready(function(){calendar=$("#calendar").fullCalendar({weekMode:"liquid",header:{left:"prev,next today",center:"title",right:"exportButton"},lang:$("html").attr("lang"),height:800,firstDay:1,defaultView:"month",buttonText:{today:Translator.trans("today")},customButtons:{exportButton:{text:Translator.trans("btn.export"),click:function(){var a=calendar.fullCalendar("getView"),t=a.intervalStart.format("DD-MM-YYYY"),e=[t],n=a.intervalStart.clone(),o=a.intervalEnd.clone();for(o.subtract(1,"days");n<o;)n.add(1,"days"),e.push(n.format("DD-MM-YYYY"));var r=$("#report_scheduleType").val(),s=Routing.generate("export_ca_prv_list",{schedule:r,dates:e});window.location.href=s}}},eventRender:function(a,t,e){var n=moment(a.date,"YYYY-MM-DD"),o="<input hidden-value='"+Math.round(a.ca)+"' date='"+n.format("DD/MM/YYYY")+"' class='ca_inputs form-control' name=ca["+a.date+"] type='text'  value='"+Math.round(a.ca)+"' >",r="<button ca-id='"+a.id+"' type='button' class='btn blue detail-btn'><span class='glyphicon glyphicon-eye-open'></span> <span class='ca-details'>"+Translator.trans("see_label")+"</span></button>",s="<button style='display:none;' ca-id='"+a.id+"' type='button' class='btn green save-ca-btn'><span class='glyphicon glyphicon-ok'></span> <span class='ca-save-label'>"+Translator.trans("btn.validate")+"</span></button>";return"<div class='inputs-btns-container'>"+r+o+s+"</div>"},eventAfterAllRender:function(a){$(".fc-exportButton-button").addClass("btn btn-export btn-icon").removeClass("fc-button fc-state-default");var t=1;$("td.fc-widget-header").find("thead tr:first").append('<th class="fc-day-header fc-widget-header fc-export">'+Translator.trans("budget_prev_export.title_table")+"</th>"),$(".fc-content-skeleton").each(function(){var a=$(this).find("thead tr:first"),e=[];$(a).find("td").each(function(){e.push($(this).attr("data-date"))}),a.append('<td class="fc-day-number fc-past">'+Translator.trans("keyword.week")+t+"</td>"),$(this).find("tbody tr:first").append('<td class="fc-event-container"><div class="inputs-btns-container"><a class="btn btn-export btn-icon export-btn" type="button" id="export-btn" style="height: 100%"data-dates="'+e.join()+'">'+Translator.trans("btn.export")+"</a></div></td>"),t+=1}),$(".fc-week").each(function(){$(this).find("tbody tr:first").append('<td class="fc-day fc-widget-content fc-sat fc-past"></td>')}),$("#report_scheduleType_container").length||$("<div id='report_scheduleType_container' style='display:inline-block;float:right; margin: 0 15px;'><select id='report_scheduleType' name='report[scheduleType]' class='form-control'><option value='0'>"+Translator.trans("report.sales.hour_by_hour.hour")+"</option><option value='1'>"+Translator.trans("report.sales.hour_by_hour.half_hour")+"</option><option value='2'>"+Translator.trans("report.sales.hour_by_hour.quarter_hour")+"</option></select></div>").insertAfter(".fc-center")},events:Routing.generate("ca_json_list")}),ajaxCall({url:Routing.generate("no_comparable_days")},function(a){noComprabableDays=a.data}),hasTheModificatioRight=hasTheRightFor("bud_prev_edit")});