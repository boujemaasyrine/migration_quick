$(function(){function a(){list_withdrawals=initSimpleDataTable("#withdrawals_table",{searching:!1,lengthMenu:!1,order:[[0,"desc"]],lengthChange:!1,paging:!1,info:!1}),list_withdrawals_waiting=initSimpleDataTable("#withdrawals_table_waiting",{searching:!0,info:!1,paging:!1,lengthChange:!1,lengthMenu:!1,initComplete:function(){this.api().columns([0]).every(function(){var a=this,e=$('<select><option value="">'+Translator.trans("fund_management.withdrawal.list.choose_member")+" </option></select>").appendTo($(".select-members-withdrawal").empty()).on("change",function(){var e=$.fn.dataTable.util.escapeRegex($(this).val());a.search(e?"^"+e+"$":"",!0,!1).draw()});a.data().unique().sort().each(function(a,t){e.append('<option value="'+a+'">'+a+"</option>")})})}})}var e=$("#AddWithdrawalForm");$("#AddEnvelopeForm");a(),$(document).on("click","#btn-validate",function(){loader.block(),ajaxCall({url:Routing.generate("withdrawal_entry"),method:POST,data:e.serialize()},function(t){if(void 0===t.errors&&void 0===t.formError){list_withdrawals.clear().draw();var r=Translator.trans("fund_management.withdrawal.entry.modal_withdrawal_set_title"),l="<h3>"+Translator.trans("fund_management.withdrawal.entry.new_envelope")+"</h3>",o=t.data.footer_btn;$("#AddWithdrawalForm").html(t.data.newForm),a(),showDefaultModal(r,l,o,null,null,!1)}else void 0===t.errors&&(e.html(t.formError[0]),a(),""!=$("#withdrawal_amountWithdrawal").val()&&$("label[for='withdrawal_amountWithdrawal']").addClass("active"));loader.unblock()})}),$(document).on("click","#btn-edit",function(){var t=$(this).attr("data-withdrawal-id");loader.show(),ajaxCall({url:Routing.generate("withdrawal_entry",{withdrawal:t}),method:POST,data:e.serialize()},function(t){if(void 0===t.errors&&void 0===t.formError)if("true"==t.data.envelope)window.location.href=Routing.generate("withdrawal_list");else{var r=Translator.trans("fund_management.withdrawal.entry.modal_withdrawal_edit_title"),l=Translator.trans("fund_management.withdrawal.entry.new_envelope"),o=t.data.footer_btn;$("#AddWithdrawalForm").html(t.data.newForm),a(),showDefaultModal(r,l,o)}else void 0===t.errors&&(e.html(t.formError[0]),a(),""!=$("#withdrawal_amountWithdrawal").val()&&$("label[for='withdrawal_amountWithdrawal']").addClass("active"))}),loader.hide()}),$(document).on("click","#envelope-validate",function(){loader.show();var a=$(this).attr("data-withdrawal-amount"),e=$(this).attr("data-withdrawal-id");ajaxCall({url:Routing.generate("envelope_entry",{withdrawal:e}),dataType:"json"},function(e){if("undefined"!=typeof e.data&&0!=e.data.length){var t=Translator.trans("fund_management.withdrawal.entry.title_envelope");showDefaultModal(t,e.data[0],e.data[1],null,null,!1),$("label[for='envelope_amount']").addClass("active"),$("#envelope_amount").attr("disabled","disabled").val(a)}else Notif.alert(Translator.trans("error.general.internal"),500,3e3)}),loader.hide()}),$(document).on("click","#envelope-create",function(){loader.show();var a=$(this).attr("data-withdrawal-id");$("#envelope_amount").removeAttr("disabled"),ajaxCall({url:Routing.generate("envelope_entry",{withdrawal:a}),method:POST,data:$("#AddEnvelopeForm").serialize()},function(a){void 0===a.errors&&void 0===a.formError?window.location.href=Routing.generate("withdrawal_entry"):void 0===a.errors&&($("#AddEnvelopeForm").html(a.formError[0]),$("#envelope_amount").attr("disabled","disabled"),$("label[for='envelope_amount']").addClass("active")),loader.hide()})}),$(document).on("click","#envelope-cancel",function(){loader.show(),ajaxCall({url:Routing.generate("cancel_envelope"),method:POST},function(a){void 0===a.errors&&void 0===a.formError&&(window.location.href=Routing.generate("withdrawal_list")),loader.hide()})}),$(document).on("change","#withdrawal_member",function(){var a=$(this).val();if(""!=a){var e=$(this).attr("data-withdrawal");"undefined"==typeof e&&(e=null),loader.show(),ajaxCall({url:Routing.generate("previous_withdrawals",{member:a,withdrawal:e}),method:POST},function(a){list_withdrawals.clear(),list_withdrawals.draw(),$.each(a.data,function(a,e){list_withdrawals.row.add([e.createdAt,e.amount]).draw().node()})}),loader.hide()}else list_withdrawals.clear(),list_withdrawals.draw()}),$(document).on("keyup","#withdrawal_amountWithdrawal",function(){var a=$(".amount-withdrawal");$(this).val()%5!=0?(a.children(".alert-danger").remove(),$(".modulo-5-error").remove(),a.append('<div class="alert alert-danger form-error modulo-5-error" role="alert"><span class="glyphicon glyphicon-warning-sign"></span>'+Translator.trans("modulo_five")+"<br></div>")):$(".modulo-5-error").remove()}),$(document).on("change","#withdrawal_amountWithdrawal",function(){var a=$(".amount-withdrawal");a.children(".modulo-5-error").remove()}),$(document).on("click",".refresh-button",function(){apiLoader.blockApiLoader(),ajaxCall({method:"GET",url:Routing.generate("retrieve_recent_tickets",{})},function(t){void 0===t.errors&&(ajaxCall({url:Routing.generate("withdrawal_entry",{validate:"noValidate"}),method:POST,data:e.serialize()},function(t){void 0===t.errors&&(e.html(t.formError[0]),a(),""!=$("#withdrawal_amountWithdrawal").val()&&$("label[for='withdrawal_amountWithdrawal']").addClass("active"))}),apiLoader.unblockApiLoader())},null,function(){})})});