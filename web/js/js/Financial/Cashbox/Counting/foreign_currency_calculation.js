var calculateForeignCurencyTotals=null;$(function(){$(document).on("focus",".exchange_rate_select",function(){$(this).attr("data-selected",!0);var e=$(".exchange_rate_select"),n=$(this).find("option"),t=($(this),{});e.each(function(e,n){"true"!==$(n).attr("data-selected")&&(t[$(this).find("option:selected").text()]=!0)}),n.each(function(e,n){""!==$(n).text()&&(void 0!==t[$(n).text()]?$(n).attr("disabled","disabled"):$(n).removeAttr("disabled"))})}),calculateForeignCurencyTotals=function(){if(cashBoxCountingIsValid){var e=0,n=$("#foreignCurrencyContainer").children(".row");n.each(function(n,t){var r=$(t).find(".foreign_currency_amount").first().val(),o=$(t).find(".exchange_rate_select").first().val(),a=$(t).find(".total_span").first(),c=parseFloat(r)*parseFloat(o);e+=c,a.text(floatToString(c))}),$(".total_foreign_currency").text(floatToString(e)),processSummaryCalculation()}},$(document).on("keyup",".foreign_currency_amount",function(){calculateForeignCurencyTotals()}),$(document).on("focusout",".exchange_rate_select",function(){$(this).attr("data-selected",!1)}),$(document).on("change",".exchange_rate_select",function(){$(this).attr("data-selected",!1);var e=$(this).find("option:selected").text();e=e.replace(/EUR => /g,"");var n=e.split(" ")[0];$(this).siblings(".foreign_currency_label_input").first().val(n),calculateForeignCurencyTotals()}),$(document).on("click","#addForeignCurrency",function(){var e=$(".exchange_rate_select").first().find("option").length,n=$("#foreignCurrencyContainer"),t=parseInt($(this).attr("data-count"));if(0===e||$("#foreignCurrencyContainer .row").length+1<=e){$(this).attr("data-count",t+1);var r=$("#addForeignCurrencyExchangeRate").data("prototype").replace(/__name__/g,t).replace(/__total__/g,"0,00");n.append($(r))}});var e="foreign_currency_amount";$(document).on("focus",".foreign_currency_amount",function(){var n=$(this);shortcutController.add(KEY_ENTER,null,null,function(){var e=$($($(n).closest(".row").next(".row")[0]).find(".foreign_currency_amount")[0]);e.focus(),e.select()},e);$(n).focusout(function(){$(document).unbind("keyup."+e)})});var n=null;$(document).on("click","#addForeignCurrencyExchangeRate",function(e){var t=Translator.trans("foreign_currency.add_new_foreign_currency"),r=$("#foreignCurrencyModalBody").html(),o=Handlebars.compile(r),a={title:"My New Post",body:"This is my first post!"},c=o(a),i=$("#foreignCurrencyModalFooter").html(),l=Handlebars.compile(i),u={title:"My New Post",body:"This is my first post!"},s=l(u);n=showDefaultModal(t,c,s),$("#foreignCurrencyForm").validate({rules:{label:{required:!0},rate:{required:!0,number:!0}}})}),$(document).on("click","#saveForeignCurrency",function(){$("#foreignCurrencyForm").valid()&&(loader.block(),ajaxCall({method:"POST",url:Routing.generate("foreign_currency",{}),data:$("#foreignCurrencyForm").serialize()},function(e){void 0===e.errors&&($(".exchange_rate_select").append('<option value="'+$("#foreignCurrencyRate").val()+'" >'+$("#foreignCurrencyLabel").val()+" => EUR  ("+$("#foreignCurrencyRate").val()+")</option>"),n.modal("hide"))},null,function(){loader.unblock()}))})});