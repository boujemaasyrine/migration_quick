$(function(){function a(){var a=moment($(".cashbox_date").first().attr("data-last-closured-date"),"YYYY/MM/DD"),t=moment($(".cashbox_date").first().attr("data-max-date"),"YYYY/MM/DD");fiscalDatepicker=initDatePicker(".cashbox_date",{disable:[!0,{from:new Date(a.format("YYYY/MM/DD")),to:new Date(t.format("YYYY/MM/DD"))}]})}function t(){loader.unblock(),apiLoader.blockApiLoader(),$.ajax({url:Routing.generate("import_last_working_date_tickets"),success:function(){apiLoader.unblockApiLoader()}})}function o(){if(""!=$("#cashbox_count_date").val()){$("#cashbox_count_date").val();loader.block(),ajaxCall({method:"POST",url:Routing.generate("cashbox_counting",{}),data:$("#cahsbox_count_form").serialize()},function(t){if(void 0===t.errors)if(1==t.data.hasIwTmp){var o=Translator.trans("cashbox.counting.withdrawals_validation.title"),n="<div><h5>"+Translator.trans("cashbox.counting.withdrawals_validation.msg1")+"</h5><h5>"+Translator.trans("cashbox.counting.withdrawals_validation.msg2",{link:Routing.generate("withdrawal_entry")})+"</h5> </div>",e="<button id='btn-cancel-load' type='button' class='btn btn-cancel' data-dismiss='modal'>"+Translator.trans("btn.close")+"</button>";showDefaultModal(o,n,e,"undefined","undefined",!1)}else $("#cashbox_count_container").html(t.data[0]),syncRealCashBlock();a()},null,function(){loader.unblock()})}}a(),t(),$(document).on("click","#reload",function(){cashBoxCountingIsValid&&(loader.block(),ajaxCall({method:"POST",url:Routing.generate("cashbox_counting",{}),data:$("#cahsbox_count_form").serialize()},function(t){void 0===t.errors&&($("#cashbox_count_container").html(t.data[0]),syncRealCashBlock()),a()},null,function(){loader.unblock()}),t())});$(document).on("change","#cashbox_count_date",function(){o()}),$(document).on("change","#cashbox_count_cashier",function(){o()}),$(document).on("click","#btn-cancel-load",function(){window.location.href=Routing.generate("cashbox_counting",{})}),$(document).on("click","#validateCashboxGap",function(){var t=!1;if($(this).hasClass("password-checked")&&(t=!0),0==t&&$(this).check_password(Translator.trans("title.popup_confirm_password"),"click",$(this),null,$("#cashbox_count_container")),1==t){if(!cashBoxCountingIsValid)return;if(""!=$("#cashbox_count_cashier").val()){var o=parseFloat($($(".total_gap").first()).text());bootbox.confirm({title:Translator.trans("cashbox.validation_confirmation",{}),message:Translator.trans("cashbox.validation_confirmation_body",{gap:"<span class='bold'>"+floatToString(o)+"<i class='glyphicon glyphicon-euro'></i></span>"}),closeButton:!1,buttons:{cancel:{label:Translator.trans("keyword.no"),className:"btn-default margin-right-left"},confirm:{label:Translator.trans("keyword.yes"),className:"btn-validate margin-right-left"}},callback:function(t){if(t){loader.block();var o=$("#cashbox_count_date").val();1===o.split(" ").length&&$("#cashbox_count_date").val(o+" 07:00:00"),ajaxCall({method:"POST",url:Routing.generate("validate_cashbox_count",{}),data:$("#cahsbox_count_form").serialize()},function(t){if(void 0===t.errors){var o=parseFloat($(".total_real_cash").first().text())-parseFloat($(".total_real_cash").first().text())%5,n=t.data.enveloppe;$("#cashbox_count_container").html(t.data[0]),syncRealCashBlock(),a(),bootbox.confirm({title:Translator.trans("cashbox.gap.gap_validated_with_success",{operator:t.data.operator,operator_name:t.data.operator_name}),message:Translator.trans("cashbox.do_you_want_created_an_enveloppe_for_this_count"),closeButton:!1,buttons:{confirm:{label:Translator.trans("keyword.yes"),className:"btn-validate margin-right-left"},cancel:{label:Translator.trans("keyword.no"),className:"btn-default margin-right-left"}},callback:function(a){if(a){var t="<span id='validateEnveloppe' class='btn btn-validate' style='margin-left: 10px;'>"+Translator.trans("btn.validate")+"</span><span id='cancelEnveloppeCreation' class='btn btn-default'>"+Translator.trans("btn.close")+"</span>";showDefaultModal(Translator.trans("envelope.envelope_creation"),n,t,"98%","",!0),$("#amount").val(o)}else loader.block(),window.location.href=Routing.generate("cashbox_counting")}})}},null,function(){loader.unblock()})}}})}}}),$(document).on("click","#validateEnveloppe",function(){loader.block("#validateEnveloppe"),loader.block(),ajaxCall({method:"POST",url:Routing.generate("create_enveloppe",{}),data:$("#enveloppe_create_form").serialize()},function(a){void 0===a.errors?window.location.href=Routing.generate("cashbox_counting"):($("#default-modal-box  p").html(a.data[0]),loader.unblock(),loader.unblock("#validateEnveloppe"))},null,function(){})}),$(document).on("click","#cancelEnveloppeCreation",function(){loader.block(),window.location.href=Routing.generate("cashbox_counting")}),$(document).on("click",".delete-row",function(){$(this).closest(".row").remove()}),$(window).keydown(function(a){if(a.keyCode==KEY_ENTER)return a.preventDefault(),!1}),$(document).on("keyup","#cashbox_count_cashContainer_totalAmount, .nextOnEnter",function(a){a.keyCode==KEY_ENTER&&$(".nav-tabs > .active").next("li").find("a").trigger("click")}),$(document).on("keyup",".only-number input[type=text]",function(a){a.stopPropagation(),32==a.keyCode&&$(this).val($.trim($(this).val())),isNaN($(this).val())?($("#validateCashboxGap").attr("disabled",!0),$("#cashbox_count_cashier").attr("disabled",!0),$("#cashbox_count_date").attr("disabled",!0),$("#reload").attr("disabled",!0),$(this).addClass("shadow-danger"),$("#total_cashbox_block").addClass("shadow-danger"),cashBoxCountingIsValid=!1):($(this).removeClass("shadow-danger"),$(".only-number input[type=text]").hasClass("shadow-danger")||($("#validateCashboxGap").attr("disabled",!1),$("#cashbox_count_cashier").attr("disabled",!1),$("#cashbox_count_date").attr("disabled",!1),$("#reload").attr("disabled",!1),cashBoxCountingIsValid=!0,$("#total_cashbox_block").removeClass("shadow-danger")))})});