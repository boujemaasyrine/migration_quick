$(function(){specialInit=function(){initProductAutocomplete($("#default-modal-box")),initSheetProductTable(),$(".bootstrap_tooltipped").tootltipBootstrap()},$(document).on("click","#btnAddNewSheet",function(){var e=$(this);loader.block(e),ajaxCall({method:"GET",url:Routing.generate("api_save_loss_sheet_model",{type:sheetsType})},function(e){void 0===e.errors&&(showDefaultModal("",e.data[0],"","98%",null,!1),init())},null,function(){loader.unblock(e)})}),$(document).on("click","#validateFormSheetModel",function(e){var t=$(this).attr("data-is-ajax");bootbox.confirm({title:Translator.trans("popup.do_you_confirm_this_action"),message:Translator.trans("loss.confirm.message"),closeButton:!1,buttons:{cancel:{label:Translator.trans("keyword.no"),className:"btn-default  margin-right-left"},confirm:{label:Translator.trans("keyword.yes"),className:"btn-validate"}},callback:function(e){if(e){sheetModelFormTable.page.len();if(sheetModelFormTable.page.len(-1).draw(),sheetModelFormTable.search("").columns().search("").draw(),loader.block(),t)ajaxCall({url:Routing.generate("api_save_loss_sheet_model",{type:sheetsType}),method:POST,data:$("#sheet_model_form").serialize()},function(e){void 0===e.errors?($("#sheet_model_form").hasClass("oldSheetModel")?Notif.success(Translator.trans("sheet_model.notification.edited_with_success",{id:e.data[2]})):Notif.success(Translator.trans("sheet_model.notification.created_with_success",{id:e.data[2]}),null,null,[{addClass:"btn btn-primary",text:Translator.trans("sheet_model.notification.btn.create_another_one"),onClick:function(e){$("#btnAddNewSheet").click(),e.close()}},{addClass:"btn btn-info",text:Translator.trans("btn.close"),onClick:function(e){e.close()}}]),sheetListDatatable.ajax.reload(),$("#default-modal-box").modal("hide"),$("#default-modal-box p").html("")):e.data.length&&($($("#default-modal-box .modal-body>p")[0]).html(e.data[0]),init()),loader.unblock()},function(e,t,a){console.log(e)},null,!0);else{var a=$("#sheet_model_form").attr("action"),o=$.addParamToUrl(a,"type",sheetsType);$("#sheet_model_form").attr("action",o),$("#sheet_model_form").submit(),$("#sheet_model_form").attr("action",a)}}}})}),$(document).on("click",".btnEditSheetModel",function(e){var t=($(this),$(this).attr("data-id"));loader.block(),ajaxCall({method:GET,url:Routing.generate("api_save_loss_sheet_model",{sheetModel:t,type:sheetsType})},function(e){loader.unblock(),void 0===e.errors&&(showDefaultModal("",e.data[0],"","98%","100%",!1),init())},null,function(){loader.unblock()})}),$(document).on("click",".product-line",function(){var e=$(this).attr("data-product-id"),t=$(this).attr("data-product-external-id"),a=$(this).attr("data-product-name"),o=$(this).attr("data-category-name"),l=!1,r=sheetModelFormTable.rows().data();if(void 0!==r[0]&&void 0!==r[0].length)for(var n=0;n<r[0].length;n++){var s=$(r[0][n]),d=$(s[1]).val();if(parseInt(d)===parseInt(e)){l=!0;break}}if(l)$(this).fadeOut(50);else{$(this).fadeOut(50);var i=$("#containerSheetModelLines"),c=parseInt(i.attr("data-count"));i.attr("data-count",c+1);var u=i.data("prototype").replace(/_line_number_/g,c).replace(/_id_product_/g,e).replace(/_ref_product_/g,t).replace(/_label_product_/g,a).replace(/_category_name_/g,o).replace(/_order_in_sheet_/g,c).replace(/_num_/g,sheetModelFormTable.data().length);sheetModelFormTable.row.add($(u)).draw(),Notif.success(Translator.trans("sheet_model.notification.item_selected_with_success",{product_name:a}))}}),$(document).on("click","#print_btn",function(){var e=$($(this).closest("form")),t=e.attr("action"),a=$.addParamToUrl(t,"download",!0);a=$.addParamToUrl(a,"type",sheetsType),e.attr("action",a);var o=sheetModelFormTable.page.len();sheetModelFormTable.page.len(-1).draw(),e.submit(),sheetModelFormTable.page.len(o).draw(),e.attr("action",t)}),$(document).on("click",".btnRemoveSheetModelLine",function(){var e=$(this).attr("data-product-id");$(".product-line"+e).fadeIn(50),sheetModelFormTable.row($(this).closest("tr")).remove().draw()})});