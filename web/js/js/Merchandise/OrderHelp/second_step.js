function getCoefTable(t){ajaxCall({url:Routing.generate("get_coef_table",{tmp:t}),dataType:"json"},function(t){$("#data-table").html(t.data),$(".no-inventory-exist-alert").tootltipBootstrap(),initDataTableForSecondStep(),loader.hide()})}function launchCoefCalculation(){var t=$("#init-product-progress-bar").attr("order-Tmp");ajaxCall({url:Routing.generate("launch_coef_calculation",{tmp:t}),dataType:"json"},function(e){null!=e.data.ProgressId&&(progressTimeInterval=window.setInterval(function(){progressBarSuivi(e.data.ProgressId,progressTimeInterval,"#coeff-product-progress-bar",function(t){return t.progress+"% ("+t.proceeded+"/"+t.total+" "+Translator.trans("product_label")+")"},function(){loader.show(),$("#progress-bars-container").hide(),getCoefTable(t)})},1e3))})}function initDataTable(){$.fn.DataTable.ext.pager.numbers_length=6,productsTable=initSimpleDataTable("#products",{columns:[null,null,null,null,{orderDataType:"t-r-f"},null,{orderDataType:"dom-text-numeric"},{orderDataType:"fixed"}],initComplete:function(t,e){$("#products_filter").parent().hide(),$("#code-product, #name-product").on("click",function(t){return t.stopPropagation(),!1})}})}function refreshDataTable(){var t=$("#supplier").val(),e=$("#categories").val();$.fn.dataTable.ext.search.pop(),null!=t&&null!=e?$.fn.dataTable.ext.search.push(function(r,a,n){return $.inArray($(productsTable.row(n).node()).attr("supplier-id"),t)>=0&&$.inArray($(productsTable.row(n).node()).attr("cat-id"),e)>=0}):null!=t?$.fn.dataTable.ext.search.push(function(e,r,a){return $.inArray($(productsTable.row(a).node()).attr("supplier-id"),t)>=0}):null!=e&&$.fn.dataTable.ext.search.push(function(t,r,a){return $.inArray($(productsTable.row(a).node()).attr("cat-id"),e)>=0}),productsTable.draw()}function initDataTableForSecondStep(){$("#supplier").selectize({plugins:["remove_button"]}),$("#categories").selectize({plugins:["remove_button"]}),ca=parseFloat($("#products").attr("ca")),initDataTable(),$("#supplier, #categories").on("change",function(){refreshDataTable()}),$("#goToStep3Btn").on("click",function(){productsTable.destroy(),$("#second_step_form").submit()}),$(document).on("change",".nature_radio",function(){var t=$("td[p-id='"+$(this).attr("target")+"']"),e=$("input[p-id='"+$(this).attr("target")+"']"),r=parseFloat(t.attr("real-qty")),a=parseFloat(t.attr("theo-qty")),n=null;"real"==$(this).val()?(n=0==r?0:ca/r,t.html(r)):(n=0==a?0:ca/a,t.html(a)),n=Math.round(n),e.val(n)})}var progressTimeInterval=null,productsTable=null,ca=null;$.fn.dataTable.ext.order["dom-text-numeric"]=function(t,e){return this.api().column(e,{order:"index"}).nodes().map(function(t,e){return parseFloat($("input",t).val())})},$.fn.dataTable.ext.order["t-r-f"]=function(t,e){return this.api().column(e,{order:"index"}).nodes().map(function(t,e){return $(t).find("input[value='real']").is(":checked")?"r":"t"})},$.fn.dataTable.ext.order.fixed=function(t,e){return this.api().column(e,{order:"index"}).nodes().map(function(t,e){return!!$(t).find("input").is(":checked")})},$(document).on("change",".fixed-checkbox",function(){var t=$(this).parent().siblings(".btn-radio-td").find("input"),e=$(this).parent().siblings(".consumed-qty-class");$(this).is(":checked")?t.prop("disabled","disabled"):void 0!=e.attr("stock-final-exist")&&"1"==e.attr("stock-final-exist")&&t.removeAttr("disabled")}),$(document).on("submit","#second_step_form",function(){$(".btn-radio-td").find("input").removeAttr("disabled")}),$(document).on("keyup","#code-product",function(){productsTable.column(0).search($(this).val(),!0,!1,!0).draw()}),$(document).on("keyup","#name-product",function(){productsTable.column(1).search($(this).val(),!0,!1,!0).draw()}),$(function(){var t=$(".progress-container");0!=t.length&&(progressTimeInterval=window.setInterval(function(){progressBarSuivi($("#init-product-progress-bar").attr("progress-id"),progressTimeInterval,"#init-product-progress-bar",function(t){return t.progress+"% ("+t.proceeded+"/"+t.total+" "+Translator.trans("product_label")+")"},function(){launchCoefCalculation()})},1e3)),initDataTableForSecondStep()});