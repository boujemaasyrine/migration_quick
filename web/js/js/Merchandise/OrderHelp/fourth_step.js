function initProductTables(){$.each($(".products"),function(e,t){initProductTable("#"+$(t).attr("id"))})}function initProductTable(e){$.fn.dataTable.ext.order["dom-text-numeric"]=function(e,t){return this.api().column(t,{order:"index"}).nodes().map(function(e,t){return $("input",e).val()})},initSimpleDataTable(e,{columns:[null,null,null,null,null,null,{orderDataType:"dom-text-numeric"}]})}function initSelectFilters(){$("#supplier-select").selectize({plugins:["remove_button"]}),$("#day-select").selectize({plugins:["remove_button"]}),$("#supplier-select, #day-select").on("change",function(){var e=$("#supplier-select").val(),t=$("#day-select").val(),r=$(".form-products");r.hide(),$.each(r,function(r,a){var n=$(a).attr("id").split("-")[1],l=$(a).attr("id").split("-")[2];null!=e&&null!=t?$.inArray(n,e)>=0&&$.inArray(l,t)>=0&&$(a).show():null==e&&null!=t?$.inArray(l,t)>=0&&$(a).show():null!=e&&null==t?$.inArray(n,e)>=0&&$(a).show():$(a).show()})})}function getResults(){loader.show(),ajaxCall({url:Routing.generate("load_results_help_order",{displayAll:displayAll}),dataType:"json"},function(e){$("#result-zone").html(e.data.html),initProductTables(),initSelectFilters(),loader.hide()})}function orderWithNoModification(e){var t=$("#pop_up_not_free_with_no_modification").html();t=t.replace(/__order_details_link__/,Routing.generate("list_pendings_commands")+"#"+e),showDefaultModal("",t,"")}function orderWithModification(){var e=$("#pop_up_not_free_with_modification").html();showDefaultModal("",e,"")}function orderFree(e,t,r){createOrder(e,t,r)}function createOrder(e,t,r,a,n){var l;l="undefined"!=typeof a?Routing.generate("create_order_from_help")+"?day="+t+"&supplier="+r+"&orderId="+a:Routing.generate("create_order_from_help")+"?day="+t+"&supplier="+r,ajaxCall({url:l,method:"POST",data:e},function(e){if(null==e.data)showDefaultModal("",'<h3><span class="glyphicon glyphicon-remove"></span>'+Translator.trans("order_not_created")+"</h3>","");else{var a=$("#order_created_pop_up_content").html();a=a.replace(/__order_details_link__/,Routing.generate("list_pendings_commands")+"#"+e.data),showDefaultModal("",a,"");var l=$(".prepare-cmd-btn[target-id='table-"+r+"-"+t+"']");l.attr("disabled","disabled"),l.siblings(".confirmation-msg").show()}"undefined"!=typeof n&&n()})}var progressTimeInterval=null,productDataTmp=null,dayNumberTmp=null,supplierIdTmp=null,idOrderTmp=null;$.fn.DataTable.ext.pager.numbers_length=6,$(document).on("click","#override-btn",function(){createOrder(productDataTmp,dayNumberTmp,supplierIdTmp,idOrderTmp,function(){productDataTmp=null,dayNumberTmp=null,supplierIdTmp=null,idOrderTmp=null})}),$(document).on("click",".prepare-cmd-btn",function(){var e="#"+$(this).attr("target-id"),t=$(e).DataTable();t.destroy();var r=$(e.replace(/table/,"form")),a=r.serialize(),n=e.split("-")[1],l=e.split("-")[2];initProductTable(e),ajaxCall({url:Routing.generate("verify_availability")+"?day="+l+"&supplier="+n},function(e){"free"==e.data.code?orderFree(a,l,n):"not_free_with_modification"==e.data.code?(productDataTmp=a,dayNumberTmp=l,supplierIdTmp=n,idOrderTmp=e.data.id,orderWithModification()):orderWithNoModification(e.data.id)})}),$(function(){var e=$(".progress-container");0!=e.length?progressTimeInterval=window.setInterval(function(){progressBarSuivi($("#calculate-result-progress").attr("progress-id"),progressTimeInterval,"#calculate-result-progress",function(e){return e.progress+"% ("+e.proceeded+"/"+e.total+" "+Translator.trans("product_label")+")"},function(){$("#progress-bars-container").remove(),getResults()})},1e3):getResults()});