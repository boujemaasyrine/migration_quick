function refreshDataTable(){var e=$("#supplier").val(),t=$("#categories").val();$.fn.dataTable.ext.search.pop(),null!=e&&null!=t?$.fn.dataTable.ext.search.push(function(r,a,n){return $.inArray($(productsTable.row(n).node()).attr("supplier-id"),e)>=0&&$.inArray($(productsTable.row(n).node()).attr("cat-id"),t)>=0}):null!=e?$.fn.dataTable.ext.search.push(function(t,r,a){return $.inArray($(productsTable.row(a).node()).attr("supplier-id"),e)>=0}):null!=t&&$.fn.dataTable.ext.search.push(function(e,r,a){return $.inArray($(productsTable.row(a).node()).attr("cat-id"),t)>=0}),productsTable.draw()}function initDataTable(){$.fn.DataTable.ext.pager.numbers_length=6,productsTable=initSimpleDataTable("#products",{order:[[1,"asc"]],columns:[null,null,{orderable:!1},{orderable:!1},{orderDataType:"t-r-f"},null,{orderDataType:"dom-text-numeric"},{orderDataType:"fixed"}],initComplete:function(e,t){$("#products_filter").parent().hide(),$("#code-product, #name-product").on("click",function(e){return e.stopPropagation(),!1})}})}function initDataTableCoef(){$("#supplier").selectize({plugins:["remove_button"]}),$("#categories").selectize({plugins:["remove_button"]}),ca=parseFloat($("#products").attr("ca")),initDataTable(),$("#supplier, #categories").on("change",function(){refreshDataTable()}),$(document).on("change",".nature_radio",function(){var e=$("td[p-id='"+$(this).attr("target")+"']"),t=$("input[p-id='"+$(this).attr("target")+"']"),r=parseFloat(e.attr("real-qty")),a=parseFloat(e.attr("theo-qty")),n=null;"real"==$(this).val()?(n=0==r?0:ca/r,e.html(r)):(n=0==a?0:ca/a,e.html(a)),n=Math.round(n),t.val(n)})}$.fn.dataTable.ext.order["dom-text-numeric"]=function(e,t){return this.api().column(t,{order:"index"}).nodes().map(function(e,t){return parseFloat($("input",e).val())})},$.fn.dataTable.ext.order["t-r-f"]=function(e,t){return this.api().column(t,{order:"index"}).nodes().map(function(e,t){return $(e).find("input[value='real']").is(":checked")?"r":"t"})},$.fn.dataTable.ext.order.fixed=function(e,t){return this.api().column(t,{order:"index"}).nodes().map(function(e,t){return!!$(e).find("input").is(":checked")})},$(document).on("keyup","#code-product",function(){productsTable.column(0).search($(this).val(),!0,!1,!0).draw()}),$(document).on("keyup","#name-product",function(){productsTable.column(1).search($(this).val(),!0,!1,!0).draw()}),$(document).on("click","#save_coef",function(){loader.show(),productsTable.destroy(),$("#coef_form").find("input").removeAttr("disabled"),$("#coef_form").submit()});var progressTimeInterval;$(function(){var e=$(".progress-container");if(0!=e.length)progressTimeInterval=window.setInterval(function(){progressBarSuivi($("#progress-bars-container").attr("progress-id"),progressTimeInterval,"#coeff-product-progress-bar",function(e){return e.progress+"% ("+e.proceeded+"/"+e.total+" "+Translator.trans("product_label")+")"},function(){window.location.href=Routing.generate("show_coeff_pp",{base:$("#progress-bars-container").attr("base-id")})})},1e3);else{initDataTableCoef();moment()}}),$(document).on("change","#coef_base_startDate, #coef_base_endDate",function(){ajaxCall({url:Routing.generate("coef_calculate_base"),data:$("form[name='coef_base']").serialize(),method:"POST"},function(e){void 0!=e.error?($("#form-zone").html(e.html),$("#ca-zone").html(" - "),initDatePicker()):($("#ca-zone").html(floatToString(e.ca,0)+" &euro; "),$(".form-error").hide())})});