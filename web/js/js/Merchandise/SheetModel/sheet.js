function init(){initDatePicker(),specialInit&&specialInit()}function initSheetProductTable(){sheetModelFormTable=initSimpleDataTable("#sheetModelFormTable",{retrieve:!0,lengthChange:!0,processing:!1,serverSide:!1,searching:!0,orderFixed:[4,"asc"],ordering:!0,aoColumnDefs:[{bSortable:!1,aTargets:["_all"]}],columnDefs:[{orderable:!0,className:"reorder",targets:4},{orderable:!1,targets:"_all"}],rowReorder:{selector:"td.draggable",dataSrc:4},paging:!1,scrollY:400,deferRender:!0,scroller:!0,scrollCollapse:!0,createdRow:function(e,t,a){}})}$.fn.DataTable.ext.pager.numbers_length=5;var specialInit=null,initProductAutocomplete=null,selectAllItemsInCategorie=null,closeFormSheetModel=$("#closeFormSheetModel"),sheetModelFormTable=null,sheetListDatatable=null,sheetModelBlock=$("#sheetModelBlock"),productCache={};$(document).on("click",".orderUp",function(){console.log("Up");var e,t=$(this).closest("tr"),a=sheetModelFormTable.page(),r=sheetModelFormTable.row(t).index();sheetModelFormTable.data().length-1;if(r>0){e=sheetModelFormTable.row(r-1).data();var o=sheetModelFormTable.row(r-1).node();sheetModelFormTable.row(r-1).data(sheetModelFormTable.row(r).data()),sheetModelFormTable.row(r).data(e);var l=$(t).find(".btnRemoveSheetModelLine").attr("data-product-id"),d=$(o).find(".btnRemoveSheetModelLine").attr("data-product-id");$("#orderInSheet_"+l).val(r),$("#orderInSheet_"+d).val(r-1)}sheetModelFormTable.page(a).draw(!1)}),$(document).on("click",".orderDown",function(){console.log("Down");var e,t=$(this).closest("tr"),a=sheetModelFormTable.page(),r=sheetModelFormTable.row(t).index(),o=sheetModelFormTable.data().length-1;sheetModelFormTable.row(o).data();if(r<o){e=sheetModelFormTable.row(r+1).data();var l=sheetModelFormTable.row(r+1).node();sheetModelFormTable.row(r+1).data(sheetModelFormTable.row(r).data()),sheetModelFormTable.row(r).data(e);var d=$(t).find(".btnRemoveSheetModelLine").attr("data-product-id"),n=$(l).find(".btnRemoveSheetModelLine").attr("data-product-id");$("#orderInSheet_"+d).val(r),$("#orderInSheet_"+n).val(r+1)}sheetModelFormTable.page(a).draw(!1)}),$(function(){function e(e){var t=$(e).attr("data-category-id"),a=$("#category_content"+t),r=!0,o=null;a.children().each(function(e,t){if("none"!=$(t).css("display")){var a=$(t).attr("data-product-id"),l=$(t).attr("data-product-external-id"),d=$(t).attr("data-product-name"),n=$(t).attr("data-category-name");$(t).fadeOut(50);var c=$("#containerSheetModelLines"),i=parseInt(c.attr("data-count"));c.attr("data-count",i+1);var s=c.data("prototype").replace(/_line_number_/g,i).replace(/_id_product_/g,a).replace(/_ref_product_/g,l).replace(/_label_product_/g,d).replace(/_category_name_/g,n).replace(/_order_in_sheet_/g,i).replace(/_num_/g,sheetModelFormTable.data().length);sheetModelFormTable.row.add($(s)).draw(),o=n,r=!1}}),r?Notif.alert(Translator.trans("sheet_model.notification.all_item_of_this_category_are_already_selected")):Notif.success(Translator.trans("sheet_model.notification.all_item_of_this_category_are_added_with_success",{category_name:o}))}function t(e){return e}$(document).on("click",".panel-heading",function(t){var a=$(t.target);$(a[0]).hasClass("panel-heading")?$($(a).find("a")[0]).click():$(a).hasClass(".select_this_categorie")&&(loader.block(),e(a[0]),loader.unblock())}),$(document).on("click",".select_this_categorie",function(t){loader.block(),e(this),loader.unblock()}),sheetListDatatable=initSimpleDataTable("#sheet-model-table",{searching:!0,processing:!0,serverSide:!0,ajax:{url:Routing.generate("api_sheet",{type:sheetsType}),type:"GET"},columns:[{data:"id"},{data:"label"},{data:null,orderable:!1,render:function(e){var t=$("#sheet-model-table").attr("data-template");return t=t.replace(/_id_/g,e.id),t=t.replace(/_sheet_label_/g,e.label)},targets:0}],drawCallback:function(){$('[data-toggle="tooltip"]').tooltip()}}),initProductAutocomplete=function(e){var a=$("#searchByCode");a.autocomplete({autoFill:!0,appendTo:$(e),source:function(e,a){var r=e.term;return t(r)in productCache?void a(productCache[t(r)]):void ajaxCall({url:Routing.generate("find_active_products",{term:r,selectedType:cibledProducts,filterSecondary:"true"}),method:GET},function(e){void 0==e.errors&&(productCache[t(r)]=$.map(e.data[0],function(e){return{id:e.id,name:e.name,label:e.externalId+"- "+e.name,value:"",externalId:e.externalId}}),a(productCache[t(r)]))},null,null,!0)},select:function(e,t){var a=$(".product-line"+t.item.id),r=a.attr("data-product-id"),o=a.attr("data-product-external-id"),l=a.attr("data-product-name"),d=a.attr("data-category-name");if("none"!==a.css("display")){a.fadeOut(50);var n=$("#containerSheetModelLines"),c=parseInt(n.attr("data-count"));n.attr("data-count",c+1);var i=n.data("prototype").replace(/_line_number_/g,c).replace(/_id_product_/g,r).replace(/_ref_product_/g,o).replace(/_label_product_/g,l).replace(/_order_in_sheet_/g,c).replace(/_category_name_/g,d);sheetModelFormTable.row.add($(i)).draw(),$("#searchByProductName").val(l)}else Notif.alert(Translator.trans("sheet_model.notification.item_already_exist",{product_name:l}));return $(this).val(""),!1}});var r=$("#searchByProductName");r.autocomplete({autoFill:!0,appendTo:$(e),source:function(e,a){var r=e.term;return t(r)in productCache?void a(productCache[t(r)]):void ajaxCall({url:Routing.generate("find_active_products",{term:r,selectedType:cibledProducts,filterSecondary:"true"}),method:GET},function(e){void 0==e.errors&&(productCache[t(r)]=$.map(e.data[0],function(e){return{id:e.id,name:e.name,label:e.externalId+" -"+e.name,value:e.name,externalId:e.externalId}}),a(productCache[t(r)]))},null,null,!0)},select:function(e,t){var a=$(".product-line"+t.item.id),r=a.attr("data-product-id"),o=a.attr("data-product-external-id"),l=a.attr("data-product-name"),d=a.attr("data-category-name");if("none"!==a.css("display")){a.fadeOut(50);var n=$("#containerSheetModelLines"),c=parseInt(n.attr("data-count"));n.attr("data-count",c+1);var i=n.data("prototype").replace(/_line_number_/g,c).replace(/_id_product_/g,r).replace(/_ref_product_/g,o).replace(/_label_product_/g,l).replace(/_category_name_/g,d).replace(/_order_in_sheet_/g,c).replace(/_num_/g,sheetModelFormTable.data().length);sheetModelFormTable.row.add($(i)).draw(),$("#searchByCode").val(o)}else Notif.alert(Translator.trans("sheet_model.notification.item_already_exist",{product_name:l}));return $(this).val(""),!1}})},initSheetProductTable(),$(".bootstrap_tooltipped").tootltipBootstrap(),$(document).on("click",".closeDefaultModal",function(){$("#default-modal-box").modal("hide"),$("#default-modal-box p").html("")}),$(document).on("click",".removeSheetModel",function(){var e=$(this).attr("sheet-label"),t=$(this).attr("data-delete-url");bootbox.confirm({title:Translator.trans("sheet_model.delete_message",{sheet_label:e}),message:Translator.trans("popup.do_you_confirm_this_action"),closeButton:!1,buttons:{confirm:{label:Translator.trans("keyword.yes"),className:"btn-validate margin-right-left"},cancel:{label:Translator.trans("keyword.no"),className:"btn-default margin-right-left"}},callback:function(e){e&&(loader.block(),ajaxCall({url:t,method:DELETE},function(e){void 0==e.errors?void 0!==e.data.redirect&&(window.location.href=e.data.redirect):loader.unblock()},null,null,!1))}})}),sheetModelFormTable.on("row-reordered",function(e,t,a){for(var r=0,o=t.length;r<o;r++)var l=$(t[r].node),d=l.find(".sorting_1").text(),n=l.find(".btnRemoveSheetModelLine").attr("data-product-id"),d=l.find("#orderInSheet_"+n).val(d.trim())})});