function loadCharts(a){var e={series:{lines:{show:!0,fill:.5},points:{show:!0,radius:4}},xaxis:{tickColor:"#fcfcfc",mode:"categories"},grid:{borderColor:"#eee",borderWidth:1,hoverable:!0,backgroundColor:"#fcfcfc"},yAxis:{min:0,tickColor:"#eee",tickFormatter:function(a){return a+" visitors"}},shadowSize:0,tooltip:!0,tooltipOpts:{content:function(a,e,t){return a+" : "+t},cssClass:"plot-tooltip"}},t=$(".chart-area"),n=$(".chart-bar");n.empty(),t.empty(),n.waitMe({bg:!1,color:"#23b7e5"}),t.waitMe({bg:!1,color:"#23b7e5"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_hour_by_hour"),error:function(){console.log("An error occurred.")},success:function(a){var t=0,o=parseInt(a.closing_hour),r=parseInt(a.opening_hour);t=o>a.opening_hour?o:23;for(var s=[],c=[],i=r;i<=t;i++)s.push([i+":00",parseFloat(a.hourByHour.ca_prev[i]).toFixed(2)]);if(o<r)for(var i=0;i<=o;i++)s.push([i+":00",parseFloat(a.hourByHour.ca_prev[i]).toFixed(2)]);for(var d=r;d<=t;d++)c.push([d+":00",a.hourByHour.ca[d].indexOf("*")>=0?"0.00":parseFloat(a.hourByHour.ca[d]).toFixed(2)]);if(o<r)for(var d=0;d<=o;d++)c.push([d+":00",a.hourByHour.ca[d].indexOf("*")>=0?"0.00":parseFloat(a.hourByHour.ca[d]).toFixed(2)]);var l=[{label:Translator.trans("report.sales.hour_by_hour.ca_prev")+" (€)",color:"#9cd159",data:s},{label:Translator.trans("report.sales.hour_by_hour.ca_brut")+" (€)",color:"#2f80e7",data:c}];n.waitMe("hide"),n.length&&$.plot(n,l,e)}})),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_ca_budget"),error:function(){console.log("An error occurred.")},success:function(a){for(var n=[],o=[],r=0;r<a.length;r++)n.push([a[r].day,parseFloat(a[r].caNetHt).toFixed(2)]);for(var r=0;r<a.length;r++)o.push([a[r].day,parseFloat(a[r].caNetNOne).toFixed(2)]);var s=[{label:Translator.trans("ca_net_htva","message"),color:"#9cd159",data:n},{label:Translator.trans("ca_net_htva_n-1","message"),color:"#2f80e7",data:o}];t.waitMe("hide"),t.length&&$.plot(t,s,e)}}))}function refreshWidget(a){var e=window[a];"function"==typeof e&&e()}function loadCaPrev(a){var e=$("#daily_budget_container"),t="<button class='btn-xs white btn-refresh' data-func='loadCaPrev'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#ffffff"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_ca_prev_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?e.append("<div class='h2 mt0'>"+parseInt(a.ca_prev)+" € </div><div class='text-uppercase'>"+Translator.trans("dayly_budget")+"</div>"):(console.log("An error occurred."),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadCaBrut(a){var e=$("#ca_brut_ttc_container"),t="<button class='btn-xs white btn-refresh' data-func='loadCaBrut'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#ffffff"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_ca_brut_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?(isNaN(a.caBrut)&&(a.caBrut=0),e.append("<div class='h2 mt0'>"+parseInt(a.caBrut)+" € </div><div class='text-uppercase'>"+Translator.trans("ca_brut_ttc")+"</div>")):(console.log("An error occurred."),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadCaNetHtva(a){var e=$("#ca_net_htva_container"),t="<button class='btn-xs white white btn-refresh' data-func='loadCaNetHtva'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#ffffff"}),caNetHtva=!1,ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_ca_net_htva_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?(isNaN(a.caNetHTva)&&(a.caNetHTva=0),e.append("<div class='h2 mt0'>"+parseInt(a.caNetHTva)+" € </div><div class='text-uppercase'>"+Translator.trans("ca_net_htva")+"</div>"),caNetHtva=parseInt(a.caNetHTva)):(console.log("An error occurred."),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadCancellation(a){var e=$("#cancels_container"),t="<button class='btn-xs white btn-refresh' data-func='loadCancellation'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#ffffff"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_cancellation_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?e.append("<div class='h2 mt0'>"+parseInt(a.cancellations_count)+" ("+parseInt(a.cancellations_value)+" € )</div><div class='text-uppercase'>"+Translator.trans("cancels")+"</div>"):(console.log("An error occurred."),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadAbandons(a){var e=$("#abandons_container"),t="<button class='btn-xs white btn-refresh' data-func='loadAbandons'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#ffffff"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_abandons_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?e.append("<div class='h2 mt0'>"+parseInt(a.abandons_count)+" ("+parseInt(a.abandons_value)+" € )</div><div class='text-uppercase'>"+Translator.trans("abandons")+"</div>"):(console.log("An error occurred."),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadCorrections(a){var e=$("#corrections_container"),t="<button class='btn-xs white btn-refresh' data-func='loadCorrections'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#ffffff"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_corrections_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?e.append("<div class='h2 mt0'>"+parseInt(a.corrections_count)+" ("+parseInt(a.corrections_value)+" € )</div><div class='text-uppercase'>"+Translator.trans("corrections")+"</div>"):(console.log("An error occurred."),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadTicketsCount(a){var e=$("#tickets_count_container"),t="<button class='btn-xs white btn-refresh' data-func='loadTicketsCount'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#ffffff"}),$("#avg_net_ticket_container").waitMe({bg:!1,color:"#ffffff"}),ticketsCount=!1,ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_tickets_count_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?(e.append("<div class='h2 mt0'>"+parseInt(a.tickets_count)+"</div><div class='text-uppercase'>"+Translator.trans("report.sales.hour_by_hour.tickets")+"</div>"),ticketsCount=parseInt(a.tickets_count)):(console.log("An error occurred."),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadNotCountedCashboxCount(a){var e=$("#not_counted_cash_box_container"),t="<button class='btn-xs white btn-refresh' data-func='loadNotCountedCashboxCount'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#ffffff"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_not_counted_cashbox_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?e.append("<div class='h2 mt0'>"+parseInt(a.not_counted_cashbox_count)+"</div><div class='text-uppercase'>"+Translator.trans("not_counted_cash_box")+"</div>"):(console.log("An error occurred: "+a.message),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadTakeOut(a){var e=$("#takeout_container"),t="<button class='btn-xs btn-refresh' data-func='loadTakeOut'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#23b7e5"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_takeout_percentage_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?e.append("<div class='panel-body' style='padding: 3px !important;'><h4 class='mt0'>"+a.takeout_percentage.toFixed(2)+"%</h4><p class='mb0 text-muted'>"+Translator.trans("takeout_comptoir")+"</p></div>"):(console.log("An error occurred: "+a.message),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadDiffCashbox(a){var e=$("#diff_cashbox_container"),t="<button class='btn-xs btn-refresh' data-func='loadDiffCashbox'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#23b7e5"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_day_income_api"),error:function(a){console.log("An error occurred."),console.log(a),e.append(t)},success:function(a){1==a.status?e.append("<h4 class='mt0'>"+parseFloat(a.diff_cashbox).toFixed(2)+"  <small>€</small> </h4><p class='mb0 text-muted'>"+Translator.trans("diff_cashbox")+"</p>"):(console.log("An error occurred: "+a.message),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadDrive(a){var e=$("#drive_container"),t="<button class='btn-xs btn-refresh' data-func='loadDrive'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#23b7e5"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_drive_percentage_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?e.append("<div class='panel-body' style='padding: 3px !important;'><h4 class='mt0'>"+a.drive_percentage.toFixed(2)+"%</h4><p class='mb0 text-muted'>"+Translator.trans("drive")+"</p></div>"):(console.log("An error occurred: "+a.message),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadKiosk(a){var e=$("#kiosk_container"),t="<button class='btn-xs btn-refresh' data-func='loadKiosk'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#23b7e5"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_kiosk_percentage_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?e.append("<div class='panel-body' style='padding: 3px !important;'><h4 class='mt0'>"+a.kiosk_percentage.toFixed(2)+"%</h4><p class='mb0 text-muted'>"+Translator.trans("kiosk_out")+"</p></div>"):(console.log("An error occurred: "+a.message),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadDelivery(a){var e=$("#delivery_container"),t="<button class='btn-xs btn-refresh' data-func='loadDelivery'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#23b7e5"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_delivery_percentage_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?e.append("<div class='panel-body' style='padding: 3px !important;'><h4 class='mt0'>"+a.delivery_percentage.toFixed(2)+"%</h4><p class='mb0 text-muted'>"+Translator.trans("delivery")+"</p></div>"):(console.log("An error occurred: "+a.message),e.append(t))},complete:function(){e.waitMe("hide")}}))}function loadEordering(a){var e=$("#e_ordering_container"),t="<button class='btn-xs btn-refresh' data-func='loadEordering'><i class='fa fa-refresh' aria-hidden='true'></i>"+Translator.trans("refresh")+"</button>";e.empty(),e.waitMe({bg:!1,color:"#23b7e5"}),ajaxRequests.push($.ajax({type:"GET",contentType:"application/json; charset=utf-8",data:{date_range:a},dataType:"json",url:Routing.generate("dashboard_e_ordering_percentage_api"),error:function(){console.log("An error occurred."),e.append(t)},success:function(a){1==a.status?e.append("<div class='panel-body'><h4 class='mt0'>"+a.e_ordering_percentage.toFixed(2)+"%</h4><p class='mb0 text-muted'>E-ordering</p></div>"):(console.log("An error occurred: "+a.message),e.append(t))},complete:function(){e.waitMe("hide")}}))}function calculateTM(){if($.isNumeric(ticketsCount)&&$.isNumeric(caNetHtva)){clearInterval(refreshId);var a=$("#avg_net_ticket_container");a.empty();var e;ticketsCount>0?(e=caNetHtva/ticketsCount,e=e.toFixed(2)):e="---",a.append("<div class='h2 mt0'>"+e+" (€) </div><div class='text-uppercase'>"+Translator.trans("report.daily_result.avg_net_ticket")+"</div>"),a.waitMe("hide")}}function abortAllAjax(){for(var a=0;a<ajaxRequests.length;a++)ajaxRequests[a].abort();ajaxRequests=[]}var DateRange={DAY_BEFORE:0,TODAY:1,WEEK:2,MONTH:3},ticketsCount=!1,caNetHtva=!1,ajaxRequests=[];$(document).ready(function(){loadCharts(DateRange.TODAY),loadCaPrev(DateRange.TODAY),loadCaBrut(DateRange.TODAY),loadCaNetHtva(DateRange.TODAY),loadCancellation(DateRange.TODAY),loadAbandons(DateRange.TODAY),loadTicketsCount(DateRange.TODAY),loadCorrections(DateRange.TODAY),loadNotCountedCashboxCount(DateRange.TODAY),loadDiffCashbox(DateRange.TODAY),loadTakeOut(DateRange.TODAY),loadDrive(DateRange.TODAY),loadKiosk(DateRange.TODAY),loadDelivery(DateRange.TODAY),loadEordering(DateRange.TODAY)}),$(document).on("click",".btn-refresh",function(){var a=$(this).data("func");refreshWidget(a)}),$(".segmented-control").on("click","#day_before_btn",function(){abortAllAjax(),$("#avg_net_ticket_container").empty(),refreshId=setInterval(calculateTM,500),loadCharts(DateRange.DAY_BEFORE),loadCaPrev(DateRange.DAY_BEFORE),loadCaBrut(DateRange.DAY_BEFORE),loadCaNetHtva(DateRange.DAY_BEFORE),loadCancellation(DateRange.DAY_BEFORE),loadAbandons(DateRange.DAY_BEFORE),loadTicketsCount(DateRange.DAY_BEFORE),loadCorrections(DateRange.DAY_BEFORE),loadNotCountedCashboxCount(DateRange.DAY_BEFORE),loadDiffCashbox(DateRange.DAY_BEFORE),loadTakeOut(DateRange.DAY_BEFORE),loadDrive(DateRange.DAY_BEFORE),loadKiosk(DateRange.DAY_BEFORE),loadDelivery(DateRange.DAY_BEFORE),loadEordering(DateRange.DAY_BEFORE)}),$(".segmented-control").on("click","#today_btn",function(){abortAllAjax(),$("#avg_net_ticket_container").empty(),refreshId=setInterval(calculateTM,500),loadCharts(DateRange.TODAY),loadCaPrev(DateRange.TODAY),loadCaBrut(DateRange.TODAY),loadCaNetHtva(DateRange.TODAY),loadCancellation(DateRange.TODAY),loadAbandons(DateRange.TODAY),loadTicketsCount(DateRange.TODAY),loadCorrections(DateRange.TODAY),loadNotCountedCashboxCount(DateRange.TODAY),loadDiffCashbox(DateRange.TODAY),loadTakeOut(DateRange.TODAY),loadDrive(DateRange.TODAY),loadKiosk(DateRange.TODAY),loadDelivery(DateRange.TODAY),loadEordering(DateRange.TODAY)}),$(".segmented-control").on("click","#this_week_btn",function(){abortAllAjax(),$("#avg_net_ticket_container").empty(),refreshId=setInterval(calculateTM,500),loadCharts(DateRange.WEEK),loadCaPrev(DateRange.WEEK),loadCaBrut(DateRange.WEEK),loadCaNetHtva(DateRange.WEEK),loadCancellation(DateRange.WEEK),loadAbandons(DateRange.WEEK),loadTicketsCount(DateRange.WEEK),loadCorrections(DateRange.WEEK),loadNotCountedCashboxCount(DateRange.WEEK),loadDiffCashbox(DateRange.WEEK),loadTakeOut(DateRange.WEEK),loadDrive(DateRange.WEEK),loadKiosk(DateRange.WEEK),loadDelivery(DateRange.WEEK),loadEordering(DateRange.WEEK)}),$(".segmented-control").on("click","#this_month_btn",function(){abortAllAjax(),$("#avg_net_ticket_container").empty(),refreshId=setInterval(calculateTM,500),loadCharts(DateRange.MONTH),loadCaPrev(DateRange.MONTH),loadCaBrut(DateRange.MONTH),loadCaNetHtva(DateRange.MONTH),loadCancellation(DateRange.MONTH),loadAbandons(DateRange.MONTH),loadTicketsCount(DateRange.MONTH),loadCorrections(DateRange.MONTH),loadNotCountedCashboxCount(DateRange.MONTH),loadDiffCashbox(DateRange.MONTH),loadTakeOut(DateRange.MONTH),loadDrive(DateRange.MONTH),loadKiosk(DateRange.MONTH),loadDelivery(DateRange.MONTH),loadEordering(DateRange.MONTH)});var refreshId=setInterval(calculateTM,500);