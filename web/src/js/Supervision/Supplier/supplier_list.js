$(function(){function t(t){e.html(t.data[0]),a.html(t.data[2]),r.siblings(".panel-body").slideToggle(),list_supplier.ajax.reload()}var a=$("#AddSupplierForm"),e=$("#modal-supplier-added"),r=$("#filter-zone-add .panel-heading");list_supplier=initSimpleDataTable("#supplier_list_table",{searching:!1,processing:!0,serverSide:!0,rowId:"id",pageLength:10,order:[[1,"asc"]],lengthChange:!0,aoColumnDefs:[{bSortable:!1,aTargets:[5]}],columns:[{data:"code"},{data:"name"},{data:"designation"},{data:"address"},{data:"phone"},{data:"mail"},{className:"actions-btn nowrap",render:function(t,a,e){var r='<a data-tooltip="'+Translator.trans("btn.edit")+'" data-position="top"class="tooltipped btn btn-modify btn-icon btn-xs modify-supplier"  style=\'margin-right: 5px;\'></a><a data-tooltip="'+Translator.trans("btn.delete")+'" data-position="top"class="tooltipped  btn btn-delete btn-icon btn-xs remove-supplier" ></a>';return r}}],ajax:{url:Routing.generate("supplier_list_export"),data:function(t){return t.criteria=serializeArrayToObjectByKey($("#supplierFilterForm").serializeArray(),"name"),t},type:"post"}}),$(document).on("click","#plus-supplier-button",function(r){loader.show(),ajaxCall({url:Routing.generate("supervision_suppliers_list"),method:POST,data:a.serialize()},function(r){void 0===r.errors&&void 0===r.formError?(t(r),showDefaultModal(Translator.trans("provider.list.add_success"),e.html()),$("#edit_new_button_"+r.data[1].id).parentsUntil("tbody","tr").attr("id",r.data[1].id),$("#edit_new_button_"+r.data[1].id).closest("td").attr("class","actions-btn")):(a.html(r.formError[0]),$("input").each(function(){""!=$(this).val()&&$("label[for='"+$(this).attr("id")+"']").addClass("active")})),loader.hide()})}),$(document).on("click","#edit-supplier-button",function(r){loader.show(),supplier=a.attr("class"),ajaxCall({url:Routing.generate("supervision_suppliers_list",{supplier:supplier}),method:POST,data:a.serialize()},function(r){void 0===r.errors&&void 0===r.formError?(list_supplier.row($("#"+supplier)).remove().draw(),t(r),showDefaultModal(Translator.trans("provider.list.edit_success"),e.html()),$(".heading-add").html('<span class="glyphicon glyphicon-plus"></span> '+Translator.trans("provider.list.add")),$("#edit_new_button_"+supplier).parentsUntil("tbody","tr").attr("id",supplier),$("#edit_new_button_"+supplier).closest("td").attr("class","actions-btn"),a.removeAttr("class")):(a.html(r.formError[0]),$("input").each(function(){""!=$(this).val()&&$("label[for='"+$(this).attr("id")+"']").addClass("active")})),loader.hide()})}),$(document).on("click",".modify-supplier",function(){loader.show();var t=$(this).parentsUntil("tbody","tr").attr("id");ajaxCall({url:Routing.generate("supervision_suppliers_list",{supplier:t}),dataType:"json"},function(e){"undefined"!=typeof e.data&&0!=e.data.length?($(".heading-add").html('<span class="glyphicon glyphicon-edit"></span> '+Translator.trans("provider.list.edit")),a.html(e.data[0]),a.removeAttr("class"),a.addClass(t),$("input").each(function(){""!=$(this).val()&&$("label[for='"+$(this).attr("id")+"']").addClass("active")}),r.siblings(".panel-body").is(":hidden")&&r.siblings(".panel-body").slideToggle(),$("html,body").animate({scrollTop:0},1200)):Notif.alert(Translator.trans("error.general.internal"),500,3e3),loader.hide()})}),$(document).on("click",".detail-btn",function(t){var a=$(this).parentsUntil("tbody","tr").attr("id");loader.show(),ajaxCall({url:Routing.generate("supplier_detail",{supplier:a}),type:"json"},function(t){showDefaultModal(Translator.trans("provider.list.details"),t.data),loader.hide()})}),$(document).on("click",".remove-supplier",function(){var t=$(this).parentsUntil("tbody","tr").attr("id");loader.show(),ajaxCall({url:Routing.generate("delete_supplier",{supplier:t}),dataType:"json"},function(t){if("undefined"!=typeof t.errors&&t.errors.length>0){var a="<div class='alert alert-danger'>"+Translator.trans(t.errors[0])+"</div>";showDefaultModal(Translator.trans("provider.list.popUp_delete"),a)}else showDefaultModal(Translator.trans("provider.list.popUp_delete"),t.html);loader.hide()})}),$(document).on("click","#btn-cancel-edit",function(){var t="<h2>"+Translator.trans("cancel.confirmation.content")+"</h2>",a="<div class='row'><div class='col col-lg-12 col-md-12 col-xs-12 col-sm-12' style='text-align: right'><button type='button' id='btn-yes-cancel-edit' class='btn waves-effect waves-light blue' data-dismiss='modal'>"+Translator.trans("yes_confirm")+"</button><button type='button' class='btn btn-cancel' data-dismiss='modal' style='margin-right: 10px'>"+Translator.trans("btn.close")+"</button></div>";showDefaultModal(Translator.trans("cancel.confirmation.title"),t,a)}),$(document).on("click","#btn-yes-cancel-edit",function(){loader.show(),ajaxCall({url:Routing.generate("supervision_suppliers_list")},function(t){void 0===t.errors?(a.html(t.data[0]),r.siblings(".panel-body").slideToggle(),$(".heading-add").html('<span class="glyphicon glyphicon-plus"></span> '+Translator.trans("provider.list.add"))):Notif.alert(Translator.trans("error.general.internal"),500,3e3),loader.hide()})}),$("#export-supplier-btn").on("click",function(){submitExportDocumentFile(".filter-zone",list_supplier,Routing.generate("supplier_list_export",{download:1}))}),$("#reset-filter").on("click",function(){resetFilter($("#filter-zone-search")),list_supplier.ajax.reload()})});