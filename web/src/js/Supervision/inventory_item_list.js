$(function(){function t(){var t=moment();initDatePicker("#inventory_item_dateSynchro",{disable:[{from:-3e3,to:[t.year(),t.month(),t.date()]}]})}function e(){var t=moment();initDatePicker("#substitute_inventory_item_dateSynchro",{disable:[{from:-3e3,to:[t.year(),t.month(),t.date()]}]})}var n=$("#AddInventoryItemForm"),a=($("#modal-inventory-item-added"),$("#filter-zone-add .panel-heading"));$(".selectize").selectize({plugins:["remove_button"]}),orderMultoSelect($("#inventory_item_restaurants")),initMultiSelect("#inventory_item_restaurants"),t(),list_inventory_item=initSimpleDataTable("#inventory_item_list_table",{searching:!0,processing:!0,serverSide:!0,rowId:"id",order:[[0,"asc"]],aoColumnDefs:[{bSortable:!1,aTargets:[6]},{width:"15%",aTargets:[6]}],columns:[{data:"code"},{data:"name"},{data:"buyingCost"},{data:"statusKey",render:function(t){return"active"==t?'<div class="label label-success" style="color:#fff !important;">'+Translator.trans("status.active")+"</div>":"toInactive"==t?'<div class="label label-warning" style="color:#fff !important;">'+Translator.trans("status.toInactive")+"</div>":"inactive"==t?'<div class="label label-danger" style="color:#fff !important;">'+Translator.trans("status.inactive")+"</div>":void 0}},{data:"dateSynchro"},{data:"lastDateSynchro"},{data:"id",className:"actions-btn nowrap",render:function(t,e,n){var a=void 0===n.restaurants?[]:JSON.parse(n.restaurants),i="";a.forEach(function(t,e){var n=t.name.replace(/\"/g,"&quot;");n=n.replace(/\'/g,"&quot;");var a=t.code;i+="<li>- "+a+"- "+n+"</li>"});var o="<button type='button' class='btn btn-deactivate bootstrap_tooltipped   btn-icon'title=\""+Translator.trans("tooltip.deactivate_invetory_item_for_restaurants")+"\"data-toggle='tooltip'>"+Translator.trans("btn.deactivate")+"</button> <button type='button' class='btn btn-view btn-icon detail-btn'>"+Translator.trans("btn.view")+"</button> <a data-item-id='{{ item.id }}' class='btn btn-modify btn-icon' style='margin-right: 3px;' href='"+Routing.generate("supervision_inventory_item_list",{productPurchased:t})+"'>"+Translator.trans("btn.edit")+"</a><span  data-elligible-restaurants='"+i+"'  data-product-name='"+n.name+"'  class='btn small-btn btn-reload bootstrap_tooltipped reload-inventory-product 'title='"+Translator.trans("keywords.force_synchronize")+"' data-item='"+t+"'><i class='fa fa-cloud-download'></i></span><a data-item-id='{{ item.id }}' class='btn small-btn btn-reload bootstrap_tooltipped substitute-btn'title='"+Translator.trans("keywords.substitute")+"' data-item='"+t+"'><i class='fa fa-exchange'></i></a>";return o}}],ajax:{url:Routing.generate("inventory_item_list_export"),data:function(t){return t.criteria=serializeArrayToObjectByKey($("#itemInventoryFilterForm").serializeArray(),"name"),t},type:"post"}}),$(document).on("click",".btn-edit",function(){loader.show();var t=$(this).attr("data-item-id");ajaxCall({url:Routing.generate("supervision_inventory_item_list",{productPurchased:t}),dataType:"json"},function(e){"undefined"!=typeof e.data&&0!=e.data.length?(n.html(e.data[0]),$(".datepicker").pickadate({disable:[{from:[0,0,0],to:yesterday}]}),n.removeAttr("class"),n.addClass(t),n.attr("action",Routing.generate("supervision_inventory_item_list",{productPurchased:t})),orderMultoSelect($("#inventory_item_restaurants")),initMultiSelect("#inventory_item_restaurants"),$(".heading-add").html('<span class="glyphicon glyphicon-edit"></span> '+Translator.trans("item.inventory.edit")),null!==e.data[1]?$("#inventory_item_secondaryItem").parent().remove():$("#inventory_item_secondaryItem").selectize({}),$("#inventory_item_supplier").selectize({}),$("input").each(function(){""!=$(this).val()&&$("label[for='"+$(this).attr("id")+"']").addClass("active")}),a.siblings(".panel-body").is(":hidden")&&a.siblings(".panel-body").slideToggle(),$("html,body").animate({scrollTop:0},1200)):Notif.alert(Translator.trans("error.general.internal"),500,3e3),loader.hide()})}),$(document).on("click","#inventory_item_list_table .btn-deactivate",function(t){var e=$(this).parentsUntil("tbody","tr").attr("id");loader.show(),ajaxCall({url:Routing.generate("supervision_inventory_item_deactivate",{inventoryItem:e}),type:"json"},function(t){showDefaultModal(Translator.trans("item.inventory.deactivate"),t.data,t.footerBtn,"80%"),loader.hide()})}),$(document).on("submit","form#form-deactivate-inventory-item",function(t){t.preventDefault();var e=$(this),n=e.attr("action");loader.show(),ajaxCall({method:"POST",url:n,data:e.serialize()},function(t){showDefaultModal(Translator.trans("item.inventory.deactivate"),t.data,t.footerBtn,"80%"),loader.hide()},"",function(t){loader.hide()})}),$(document).on("click",".detail-btn",function(t){var e=$(this).parentsUntil("tbody","tr").attr("id");loader.show(),ajaxCall({url:Routing.generate("supervision_inventory_item_detail",{inventoryItem:e}),type:"json"},function(t){showDefaultModal(Translator.trans("item.inventory.details"),t.data,t.footerBtn,"95%"),initSimpleDataTable("#item_restaurants_table",{lengthChange:!1,searching:!1,pageLength:5}),initSimpleDataTable("#supplier_resto_list_table",{lengthChange:!1,searching:!1,pageLength:5}),loader.hide()})}),$(document).on("click","#validate-substitution",function(t){var n=$("#form-substitute"),a=$("#substitute_inventory_item_mainProduct").val();loader.show(),ajaxCall({url:Routing.generate("inventory_item_substitute",{inventoryItem:a}),method:"POST",data:n.serialize()},function(t){showDefaultModal(Translator.trans("item.inventory.substitute"),t.data,t.footerBtn,"95%"),initSimpleDataTable("#recipe_lines_table",{}),e(),$("#substitute_inventory_item_productPurchased").selectize({plugins:["remove_button"]}),loader.hide()})}),$(document).on("click",".substitute-btn",function(t){var n=$(this).parentsUntil("tbody","tr").attr("id");loader.show(),ajaxCall({url:Routing.generate("inventory_item_substitute",{inventoryItem:n}),type:"json"},function(t){showDefaultModal(Translator.trans("item.inventory.substitute"),t.data,t.footerBtn,"95%"),initSimpleDataTable("#recipe_lines_table",{}),e(),$("#substitute_inventory_item_productPurchased").selectize({plugins:["remove_button"]}),loader.hide()})}),$(document).on("click",".btn-remove",function(){var t=$(this).attr("data-item-id");loader.show(),ajaxCall({url:Routing.generate("activate_inventory_item",{productPurchased:t,activate:"false"}),dataType:"json"},function(t){if("undefined"!=typeof t.errors&&t.errors.length>0){var e="<div class='alert alert-danger'>"+Translator.trans(t.errors[0])+"</div>";showDefaultModal(Translator.trans("item.inventory.delete"),e)}else showDefaultModal(Translator.trans("item.inventory.delete"),t.html);loader.hide()})}),$(document).on("click",".btn-activate",function(){var t=$(this).attr("data-item-id");loader.show(),ajaxCall({url:Routing.generate("activate_inventory_item",{productPurchased:t,activate:"true"}),dataType:"json"},function(t){if("undefined"!=typeof t.errors&&t.errors.length>0){var e="<div class='alert alert-danger'>"+Translator.trans(t.errors[0])+"</div>";showDefaultModal(Translator.trans("item.inventory.delete"),e)}else showDefaultModal(Translator.trans("item.inventory.delete"),t.html);loader.hide()})}),$(document).on("change","#inventory_item_status",function(){var t=$(this).val(),e=$("#inventory_item_deactivationDate");"toInactive"==t?(e.closest(".col").removeAttr("style"),highlightInput("#inventory_item_deactivationDate","shadow-danger")):e.closest("col").attr("style","display:none;")}),$(document).on("click","#btn-cancel-edit",function(){var t="<h2>"+Translator.trans("cancel.confirmation.content")+"</h2>",e="<div class='row'><div class='col col-lg-12 col-md-12 col-xs-12 col-sm-12' style='text-align: right'><button type='button' id='btn-yes-cancel-edit' class='btn waves-effect waves-light blue'>"+Translator.trans("yes_confirm")+"</button><button type='button' class='btn btn-cancel' data-dismiss='modal' style='margin-right: 10px'>"+Translator.trans("btn.close")+"</button></div>";showDefaultModal(Translator.trans("cancel.confirmation.title"),t,e)}),$(document).on("click","#btn-yes-cancel-edit",function(){$(location).attr("href",Routing.generate("supervision_inventory_item_list"))}),$("#export-btn").on("click",function(){submitExportDocumentFile(".filter-zone",list_inventory_item,Routing.generate("inventory_item_list_export",{download:1}))}),$("#reset-filter").on("click",function(){resetFilter($("#filter-zone-search")),$select=$("#inventory_item_search_supplierSearch").selectize({});var t=$select[0].selectize;t.clear(),list_inventory_item.ajax.reload()}),$(document).on("change","#inventory_item_inventoryQty",function(){var t=$("#inventory_item_labelUnitExped"),e=$("#inventory_item_labelUnitInventory"),n=$("#conversion_exped_invent");n.html(t.find("option:selected").text()+" = "+$(this).val()+" "+e.find("option:selected").text())}),$(document).on("change","#inventory_item_labelUnitExped",function(){var t=$("#inventory_item_labelUnitInventory"),e=$("#inventory_item_inventoryQty"),n=$("#conversion_exped_invent");n.html($(this).find("option:selected").text()+" = "+e.val()+" "+t.find("option:selected").text())}),$(document).on("change","#inventory_item_labelUnitInventory",function(){var t=$("#inventory_item_labelUnitExped"),e=$("#inventory_item_labelUnitUsage"),n=$("#inventory_item_inventoryQty"),a=$("#inventory_item_usageQty"),i=$("#conversion_exped_invent"),o=$("#conversion_invent_usage");i.html(t.find("option:selected").text()+" = "+n.val()+" "+$(this).find("option:selected").text()),o.html($(this).find("option:selected").text()+" = "+a.val()+" "+e.find("option:selected").text())}),$(document).on("change","#inventory_item_labelUnitUsage",function(){var t=$("#inventory_item_labelUnitInventory"),e=$("#inventory_item_usageQty"),n=$("#conversion_invent_usage");n.html(t.find("option:selected").text()+" = "+e.val()+" "+$(this).find("option:selected").text())}),$(document).on("change","#inventory_item_usageQty",function(){var t=$("#inventory_item_labelUnitInventory"),e=$("#inventory_item_labelUnitUsage"),n=$("#conversion_invent_usage");n.html(t.find("option:selected").text()+" = "+$(this).val()+" "+e.find("option:selected").text())}),$(document).on("click","#submit-inventory-item-form",function(t){t.preventDefault(),$("#AddInventoryItemForm").submit()}),$(document).on("click","#submit-inventory-item-form-synchronize",function(t){t.preventDefault();var e=$("#AddInventoryItemForm"),n=e.attr("action");e.attr("action",$.addParamToUrl(n,"synchronize",!0)),$(e).submit()}),$(document).on("click",".reload-inventory-product",function(){var t=$(this).attr("data-item"),e=$(this).attr("data-elligible-restaurants"),n=$(this).attr("data-product-name");bootbox.confirm({title:Translator.trans("product.synchronization_title"),message:Translator.trans("product.synchronization_message",{product:n,restaurants:e}),closeButton:!1,buttons:{cancel:{label:Translator.trans("keyword.no"),className:"btn btn-cancel btn-icon margin-right-left"},confirm:{label:Translator.trans("keyword.yes"),className:"btn btn-validate btn-icon margin-right-left pull-right"}},callback:function(e){e&&(loader.show(),ajaxCall({url:Routing.generate("force_synchronize_purchased_product",{productPurchased:t}),type:"json"},function(t){void 0!==t.data.sucess&&location.reload(),loader.hide()}))}})})});